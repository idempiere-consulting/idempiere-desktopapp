<!DOCTYPE html>
<html lang="en" dir="ltr">

<head>
    <meta charset="utf-8">
    <title>Idempiere App</title>
    <link rel="stylesheet" href="assets/css/mainWindow.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css">
    <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js" type="text/javascript"></script>
</head>

<body>

    <input type="checkbox" id="check">
    <!--header area start-->
    <header>
        <label for="check">
        <i style=" left: 260px" class="fas fa-bars" id="sidebar_btn"></i>
      </label>
        <label>
        <i style=" left: 315px" class="fas fa-arrow-alt-circle-left" id="back_btn"></i>
      </label>
        <div class="left_area">
            <h3>Ticket > <span>Supporto</span></h3>
        </div>
        <div class="right_area">
            <a href="#" class="logout_btn">Logout</a>
        </div>
    </header>
    <!--header area end-->
    <!--sidebar start-->
    <div class="sidebar">
        <center>
            <img src="assets/images/logo.png" class="profile_image" alt="" width="200" height="200">
            <h4>Admin</h4>
        </center>
        <a href="#" id="Supporto"><i class="fas fa-question-circle"></i><span>Supporto</span></a>
        <a href="#" id="Sessione"><i class="fas fa-desktop"></i><span>Rich. Sessione</span></a>
        <a href="#" id="Ticket"><i class="fas fa-file-signature"></i><span>Crea Ticket</span></a>
    </div>
    <!--sidebar end-->

    <div class="content">
        <table>
            <thead>
                <tr>
                    <th>
                        <div class="radio-check">
                            <label>Priorità:
                <input type="Radio" name="Prio"  value="All" checked="checked"/>
                <span>All</span></label>
                            <label>
            <input type="Radio" name="Prio"  value="Minore" />
            <span>Minore</span></label>
                            <label>
            <input type="Radio" name="Prio"  value="Bassa"/>
            <span>Bassa</span></label>
                            <label>
            <input type="Radio" name="Prio"  value="Media"/>
            <span>Media</span></label>
                            <label>
            <input type="Radio" name="Prio"  value="Alta"/>
            <span>Alta</span></label>
                            <label>
            <input type="Radio" name="Prio"  value="Urgente"/>
            <span>Urgente</span></label>
                        </div>
                    </th>
                </tr>
            </thead>
        </table>
        <table class="myTable2">
            <thead>
                <tr>
                    <th><input type="text" id="myInput" onkeyup="filterBP()" placeholder="Filtra per BPartner" title="Scrivi un nome"></th>
                    <th><input type="text" id="myInputPhone" onkeyup="filterAcc()" placeholder="Filtra per Utente" title="Scrivi un nome"></th>
                    <th><input type="text" id="myInputMail" onkeyup="filterReq()" placeholder="Filtra per Richiesta" title="Scrivi un nome"></th>
                    <th></th>
                    <th><input type="text" id="myInputSalesRep" onkeyup="filterSumm()" placeholder="Filtra per Riepilogo" title="Scrivi un nome"></th>
                    <th><input type="text" id="myInputCampaign" onkeyup="filterDate()" placeholder="Filtra per Data" title="Scrivi un nome"></th>
                    <th></th>
                </tr>
            </thead>
        </table>
        <table id="myTable" class="table-sortable">

            <thead>
                <tr>
                    <th>BPartner</th>
                    <th>Nome Account</th>
                    <th>Tipo Richiesta</th>
                    <th>Priorità</th>
                    <th>Riepilogo</th>
                    <th>Data Creazione</th>
                </tr>
            </thead>
            <tbody id="leadBody">
            </tbody>
        </table>
    </div>

    <script>
        const electron = require('electron');
        const {
            ipcRenderer
        } = electron;

        const authToken = ipcRenderer.sendSync('send:token', 'ping');
        const userBPartner = ipcRenderer.sendSync('send:bp', 'ping');
        const ip = ipcRenderer.sendSync('send:ip', 'ping');
        //console.log(userBPartner);
        getTickets();


        const back = document.getElementById('back_btn');
        const supp = document.getElementById('Supporto');
        const sess = document.getElementById('Sessione');
        const tick = document.getElementById('Ticket');


        back.addEventListener('click', viewMainPage);
        supp.addEventListener('click', viewSupportoPage);
        sess.addEventListener('click', viewSessionePage);
        tick.addEventListener('click', viewTicketPage);


        function viewMainPage(e) {
            e.preventDefault();
            const page = 2;
            //console.log(page);
            ipcRenderer.send('page:change', page);
        }

        function viewSupportoPage(e) {
            e.preventDefault();
            const page = 1;
            //console.log(page);
            ipcRenderer.send('page:TicketP', page);
        }

        function viewSessionePage(e) {
            e.preventDefault();
            const page = 2;
            //console.log(page);
            ipcRenderer.send('page:TicketP', page);
        }

        function viewTicketPage(e) {
            e.preventDefault();
            const page = 3;
            //console.log(page);
            ipcRenderer.send('page:TicketP', page);
        }

        function getTickets() {

            fetch('http://' + ip + '/api/v1/windows/request', {
                    method: 'GET',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': 'Bearer ' + authToken
                    }
                }).then(res => {
                    return res.json()
                })
                .then(data => {
                    console.log(data);

                    //var pData = JSON.parse(data)

                    a = data['window-records'];
                    //console.log(a);
                    a.forEach((record) => {
                        var table = document.getElementById('leadBody');
                        var bp = record.C_BPartner_ID;
                        var user = record.AD_User_ID;
                        var req = record.R_RequestType_ID;
                        var prio = record.Priority;
                        var row = `<tr class="dataRow"> 
							<td>${bp['identifier']}</td>
							<td>${user['identifier']}</td>
							<td>${req['identifier']}</td>
							<td>${prio['identifier']}</td>
							<td>${record.Summary}</td>
							<td>${record.Created.slice(0,10)}</td>
							<td><a href="#" id="iconLinkWebUrl"><i class="fas fa-external-link-alt"></i></td>
					  </tr>`;
                        if (userBPartner == bp['identifier']) {
                            table.innerHTML += row;
                        }


                    });


                })
                .catch(error => console.log(error))
        }

        //test jquery filter

        $("input[type=radio]").change(function() {
            var filter = this.value;
            if (filter == "All")
                $("tr.dataRow").css("visibility", "visible");
            else $("tr.dataRow").css("visibility", "collapse");
            var matchFound = false;
            $("tr.dataRow").find("td").each(function() {
                $this = $(this);
                if (!matchFound) {
                    if ($this.html() == filter) {
                        //matchFound = true;
                        $this.parent().css("visibility", "visible");
                    }
                }
            });
        });



        function filterAcc() {
            var input, filter, table, tr, td, i, txtValue;
            input = document.getElementById("myInputPhone");
            filter = input.value.toUpperCase();
            table = document.getElementById("myTable");
            tr = table.getElementsByTagName("tr");
            for (i = 0; i < tr.length; i++) {
                td = tr[i].getElementsByTagName("td")[1];
                if (td) {
                    txtValue = td.textContent || td.innerText;
                    if (txtValue.toUpperCase().indexOf(filter) > -1) {
                        tr[i].style.display = "";
                    } else {
                        tr[i].style.display = "none";
                    }
                }
            }
        }

        function filterBP() {
            var input, filter, table, tr, td, i, txtValue;
            input = document.getElementById("myInput");
            filter = input.value.toUpperCase();
            table = document.getElementById("myTable");
            tr = table.getElementsByTagName("tr");
            for (i = 0; i < tr.length; i++) {
                td = tr[i].getElementsByTagName("td")[0];
                if (td) {
                    txtValue = td.textContent || td.innerText;
                    if (txtValue.toUpperCase().indexOf(filter) > -1) {
                        tr[i].style.display = "";
                    } else {
                        tr[i].style.display = "none";
                    }
                }
            }
        }

        function filterReq() {
            var input, filter, table, tr, td, i, txtValue;
            input = document.getElementById("myInputMail");
            filter = input.value.toUpperCase();
            table = document.getElementById("myTable");
            tr = table.getElementsByTagName("tr");
            for (i = 0; i < tr.length; i++) {
                td = tr[i].getElementsByTagName("td")[2];
                if (td) {
                    txtValue = td.textContent || td.innerText;
                    if (txtValue.toUpperCase().indexOf(filter) > -1) {
                        tr[i].style.display = "";
                    } else {
                        tr[i].style.display = "none";
                    }
                }
            }
        }

        function filterSumm() {
            var input, filter, table, tr, td, i, txtValue;
            input = document.getElementById("myInputSalesRep");
            filter = input.value.toUpperCase();
            table = document.getElementById("myTable");
            tr = table.getElementsByTagName("tr");
            for (i = 0; i < tr.length; i++) {
                td = tr[i].getElementsByTagName("td")[4];
                if (td) {
                    txtValue = td.textContent || td.innerText;
                    if (txtValue.toUpperCase().indexOf(filter) > -1) {
                        tr[i].style.display = "";
                    } else {
                        tr[i].style.display = "none";
                    }
                }
            }
        }

        function filterDate() {
            var input, filter, table, tr, td, i, txtValue;
            input = document.getElementById("myInputCampaign");
            filter = input.value.toUpperCase();
            table = document.getElementById("myTable");
            tr = table.getElementsByTagName("tr");
            for (i = 0; i < tr.length; i++) {
                td = tr[i].getElementsByTagName("td")[5];
                if (td) {
                    txtValue = td.textContent || td.innerText;
                    if (txtValue.toUpperCase().indexOf(filter) > -1) {
                        tr[i].style.display = "";
                    } else {
                        tr[i].style.display = "none";
                    }
                }
            }
        }
    </script>

</body>

</html>