<!DOCTYPE html>
<html lang="en" dir="ltr">
  <head>
    <meta charset="utf-8">
    <title>Idempiere App</title>
    <link rel="stylesheet" href="assets/css/mainWindow.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css">
  </head>
  <body>

    <input type="checkbox" id="check">
    <!--header area start-->
    <header>
      <label for="check">
        <i style=" left: 285px" class="fas fa-bars" id="sidebar_btn"></i>
      </label>
      <label>
        <i style=" left: 340px" class="fas fa-arrow-alt-circle-left" id="back_btn"></i>
      </label>
      <div class="left_area">
        <h3>Ticket > <span>Crea Ticket</span></h3>
      </div>
      <div class="right_area">
        <a href="#" class="logout_btn">Logout</a>
      </div>
    </header>
    <!--header area end-->
    <!--sidebar start-->
    <div class="sidebar">
      <center>
        <img src="assets/images/logo.png" class="profile_image" alt="" width="200" height="200">
        <h4>Admin</h4>
      </center>
      <a href="#" id="Supporto"><i class="fas fa-question-circle"></i><span>Supporto</span></a>
      <a href="#" id="Sessione"><i class="fas fa-desktop"></i><span>Rich. Sessione</span></a>
      <a href="#" id="Ticket"><i class="fas fa-file-signature"></i><span>Crea Ticket</span></a>
    </div>
    <!--sidebar end-->

    <div class="content">
    <div id="createPage" "overflow-y: auto;">
        <form>

            <label class="formLabel" for="fname">Utente</label>
            <input type="text" id="fname" name="firstname" placeholder="Your name..">

            <label class="formLabel" for="lname">Business Partner</label>
            <input type="text" id="lname" name="lastname" placeholder="Your last name..">

            <label class="formLabel" for="priority">Priorità</label>
            <select id="priority" name="priority">
                <option value="9">Minore</option>
                <option value="7">Bassa</option>
                <option value="5">Media</option>
                <option value="3">Alta</option>
                <option value="1">Urgente</option>
            </select>
            
            <label class="formLabel" for="requestType">Tipo Richiesta</label>
            <select id="requestType" name="requestType">
                <option value=""></option>
                <option value="Anomalia">Anomalia</option>
                <option value="Rich formazione"> Richiesta di Formazione</option>
                <option value="Nuova Richiesta Funzionalità/Sviluppo">Nuova Richiesta Funzionalità/Sviluppo</option>
                <option value="Altro">Altro</option>
            </select>
            <div style="margin-bottom: 22px;" id="caseRequest">
            </div>

    <input type="submit" id="sendBtn" value="Submit">

  </form>
  </div>
    </div>
    
    <script>
        const electron = require('electron');
        const {ipcRenderer} = electron;
        
        const authToken = ipcRenderer.sendSync('send:token', 'ping');
        const userBPartner = ipcRenderer.sendSync('send:bp', 'ping');
        const userName = ipcRenderer.sendSync('send:user', 'ping');
        
        
        document.getElementById("fname").value = userName;
        document.getElementById("lname").value = userBPartner;
        document.getElementById('fname').readOnly = true;
        document.getElementById('lname').readOnly = true;
        
        const back = document.getElementById('back_btn');
        const supp = document.getElementById('Supporto');
        const sess = document.getElementById('Sessione');
        const tick = document.getElementById('Ticket');
        const sendbtn = document.getElementById('sendBtn');
        const reqSel = document.getElementById('requestType');
        const caseDiv = document.getElementById('caseRequest');
        
        back.addEventListener('click', viewMainPage);
        supp.addEventListener('click', viewSupportoPage);
        sess.addEventListener('click', viewSessionePage);
        tick.addEventListener('click', viewTicketPage);
        sendBtn.addEventListener('click', sendDataTicket);
        
        
        reqSel.addEventListener('change', function(){
            caseDiv.innerHTML = "";
            if(reqSel.value == 'Anomalia'){
                var text = `<label class="formLabel" for="explain">Descrivi il problema</label>
                            <textarea id="explain" name="explain" placeholder="Scrivi qualcosa..." style="height:200px"></textarea>`;
                
                caseDiv.innerHTML += text;
                
                text = `<label class="formLabel" for="Document">N° Documento</label>
                        <input type="text" id="Document" name="Document" placeholder="">`
                
                caseDiv.innerHTML += text;
                
                text = `<label class="formLabel" for="explain2">Dettaglio errore a video</label>
                        <textarea id="explain2" name="explain2" placeholder="Scrivi qualcosa..." style="height:200px"></textarea>`;
                caseDiv.innerHTML += text;
                
                text = `<label class="formLabel" for="explain3">Azione che si stava facendo</label>
                        <textarea id="explain3" name="explain3" placeholder="Scrivi qualcosa..." style="height:200px"></textarea>`;
                caseDiv.innerHTML += text;
                
                text = `<label class="formLabel" for="explain4">E' bloccante?</label>
                        <textarea id="explain4" name="explain4" placeholder="Scrivi qualcosa..." style="height:200px"></textarea>`;
                caseDiv.innerHTML += text;
                
            }
            
            if(reqSel.value == 'Nuova Richiesta Funzionalità/Sviluppo'){
                var text = `<label class="formLabel" for="explain">Spiega cosa vorresti che sia sviluppato su Idempiere</label>
                            <textarea id="explain" name="explain" placeholder="Scrivi qualcosa..." style="height:200px"></textarea>`;
                
                caseDiv.innerHTML += text;
            }
            
            if(reqSel.value == 'Altro'){
                var text = `<label class="formLabel" for="explain">Spiega il problema non classificabile dal Tipo Richiesta</label>
                            <textarea id="explain" name="explain" placeholder="Write something.." style="height:200px"></textarea>`;
                
                caseDiv.innerHTML += text;
            }
            
        });
        
        
        function viewMainPage(e){
            e.preventDefault();
            const page = 2;
            //console.log(page);
            ipcRenderer.send('page:change', page);
        }
        
        function viewSupportoPage(e){
            e.preventDefault();
            const page = 1;
            //console.log(page);
            ipcRenderer.send('page:TicketP', page);
        }
        
        function viewSessionePage(e){
            e.preventDefault();
            const page = 2;
            //console.log(page);
            ipcRenderer.send('page:TicketP', page);
        }
        
        function viewTicketPage(e){
            e.preventDefault();
            const page = 3;
            //console.log(page);
            ipcRenderer.send('page:TicketP', page);
        }
        
        function sendDataTicket(e){
            e.preventDefault();
            const UserName = document.getElementById('fname').value;
            const BP = document.getElementById('lname').value;
            const Request = reqSel.value;
            const prio = document.getElementById('priority').value;
            const explain = document.getElementById('explain').value;
            let BodyData;
            
            switch (Request){
                
                case "Anomalia":
                    const doc = document.getElementById('Document').value;
                    const explain2 = document.getElementById('explain2').value;
                    const explain3 = document.getElementById('explain3').value;
                    const explain4 = document.getElementById('explain4').value;
                    BodyData = {
                                    "C_BPartner_ID" : { "identifier": BP },
                                    "AD_User_ID" : { "identifier": UserName },
                                    "AD_Client_ID" : { "identifier": "DEMO" },
                                    "R_RequestType_ID" : { "id": 1000000 },
                                    "Priority" : { "id": prio },
                                    "SalesRep_ID": { "identifier": "DEMOAdmin"},
                                    "AD_Role_ID": {"id": 1000000 },
                                    "DueType" : { "id": "5" },
                                    "AD_Org_ID" : { "id": 0 },
                                    "ConfidentialTypeEntry" : {"id" : "C" },
                                    "ConfidentialType" : { "id" : "C" },
                                    "RequestAmt": 0,
                                    "Summary" : explain,
                                    "Description" : doc,
                                    "Name" : explain2,
                                    "Help" : explain3
                                };
                    break;
                case "Altro":
                    BodyData = {
                                    "C_BPartner_ID" : { "identifier": BP },
                                    "AD_User_ID" : { "identifier": UserName },
                                    "AD_Client_ID" : { "identifier": "DEMO" },
                                    "R_RequestType_ID" : { "id": 1000002 },
                                    "Priority" : { "id": prio },
                                    "SalesRep_ID": { "identifier": "DEMOAdmin"},
                                    "AD_Role_ID": {"id": 1000000 },
                                    "DueType" : { "id": "5" },
                                    "AD_Org_ID" : { "id": 0 },
                                    "ConfidentialTypeEntry" : {"id" : "C" },
                                    "ConfidentialType" : { "id" : "C" },
                                    "RequestAmt": 0,
                                    "Summary" : explain
                                };
                    break;
                case "Nuova Richiesta Funzionalità/Sviluppo":
                    BodyData = {
                                    "C_BPartner_ID" : { "identifier": BP },
                                    "AD_User_ID" : { "identifier": UserName },
                                    "AD_Client_ID" : { "identifier": "DEMO" },
                                    "R_RequestType_ID" : { "id": 1000003 },
                                    "Priority" : { "id": prio },
                                    "SalesRep_ID": { "identifier": "DEMOAdmin"},
                                    "AD_Role_ID": {"id": 1000000 },
                                    "DueType" : { "id": "5" },
                                    "AD_Org_ID" : { "id": 0 },
                                    "ConfidentialTypeEntry" : {"id" : "C" },
                                    "ConfidentialType" : { "id" : "C" },
                                    "RequestAmt": 0,
                                    "Summary" : explain
                                };
                    break;
                
            }
            
            
            
            fetch('http://173.249.60.71:3580/api/v1/windows/request' ,{
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': 'Bearer ' + authToken
                },
                body: JSON.stringify(BodyData)
            }).then(res => {
                return res.json()
                })
                .then(data => {
                    console.log(data);
                })
                .catch(error => console.log(error))
        
        }
        

        
        
    
    </script>

  </body>
</html>
